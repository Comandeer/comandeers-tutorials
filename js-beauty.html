<!DOCTYPE html>
	<html lang="pl" dir="ltr" class="no-js">
		<head>
			<meta charset="UTF-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
			<script>
			(function(H,c){H[c]=H[c].replace(/\bno-js\b/,'')+' js'})(document.documentElement,'className');

			if ( location.host === 'tutorials.comandeer.pl' ) {
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','//www.google-analytics.com/analytics.js','ga');


				ga('create', 'UA-33158520-2', 'auto');
				ga('send', 'pageview');
			}

			/*
			 Details primitive polyfill by Comandeer
			 */
			"open"in document.createElement("details")||document.addEventListener("DOMContentLoaded",function(){try{[].forEach.call(document.querySelectorAll("details"),function(e){var t=e.querySelector("summary"),n=function(n){n?(e.removeAttribute("open"),t.setAttribute("aria-expanded",!1)):(e.setAttribute("open","open"),t.setAttribute("aria-expanded",!0))},i=function(){n(e.hasAttribute("open"))};n(!e.hasAttribute("open")),t.setAttribute("tabindex",0),t.setAttribute("role","button"),t.addEventListener("click",i),t.addEventListener("keyup",function(e){-1!==[13,32].indexOf(e.keyCode)&&(e.preventDefault(),this.click())})})}catch(e){}})
			</script>
			<title>Wypieść swój JS</title>
			<!--[if lt IE 9]>
				<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
			<![endif]-->
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
			<link rel="stylesheet" href="/css/prism.css">
			<link rel="stylesheet" href="/css/bs/custom.css">
		</head>
		<body>
			<header class="navbar navbar-inverse navbar-fixed-top">
				<div class="container-fluid">
					<div class="navbar-header">
						<h1 class="navbar-brand"><a href="/" title="« Powrót do spisu tutoriali">Tutorials</a></h1>
					</div>
				</div>
			</header>

			<div class="container-fluid">
				<div class="row">
					<nav class="sidebar col-md-4 well">
		<h2 class="sidebar-header">Spis treści</h2>
			<div class="sidebar-inner">
				<ul class="unstyled">
				<li><a href="#parser">Inteligentny parser</a></li><li><a href="#krotszy-zapis">Krótszy zapis</a></li><li><a href="#strict">Strict mode</a></li><li><a href="#literaly">Literały</a></li><li><a href="#setTimeout">setTimeout</a></li><li><a href="#petle">Pętle i obiekty</a></li><li><a href="#namespaces">Funkcje natychmiastowego wywołania i przestrzenie nazw</a></li><li><a href="#feature-detection">Feature detection</a></li><li><a href="#delegation">Event delegation</a></li>
				</ul>
			</div>
		</nav>

					<main class="col-md-8 col-md-offset-0">
						<article>
						<div class="heading"><h2 id="start">Wypieść swój JS</h2> <a href="#start" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>

<p class="alert alert-danger">Ten tutorial jest już niestety dość przestarzały i opisuje starszą wersję standardu JS (ECMAScript 5) a także niektóre praktyki, których obecnie nawet ja nie uznaję już za najlepsze. Dlatego lepiej potraktuj go wyłącznie jako ciekawostkę historyczną… i poczekaj aż napiszę o JS coś równie sensownego.</p>

<div class="heading"><h3 id="parser">Inteligentny parser</h3><a href="#parser" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>JS to język, który pozwala chyba na największą dowolność w składni ze wszystkich języków programowania. Ba, jego parser jest tak sprawny, że sam sobie wstawia średniki w miejscach, w których być powinny.</p>
<p class="code">Kod:</p><pre><code class="language-javascript">return
{};</code></pre>
<p>Ten krótki kod – mimo że na pierwszy, a nawet drugi rzut oka wydaje się poprawny – rzuci nam ładny błąd na konsolę. Czemu? Bo parser widzi go tak:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">return; //bo niedbały programista zapomniał go tu dać
{}; //o, a co tu robi definicja obiektu?</code></pre>
<p>Przez to małe głupstwo kiedyś zraziłem się do JSON i za wszelką cenę próbowałem go omijać. Dlatego na sam początek porad ot, taki mały kwiatek z własnego doświadczenia.</p>

<div class="heading"><h3 id="krotszy-zapis">Krótszy zapis</h3><a href="#krotszy-zapis" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p class="code">Kod:</p><pre><code class="language-javascript">var width = 0;
var height = 0;
var img = null;
var elem = null;</code></pre>
<p>vs.</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var width = 0
,height = 0
,img = null
,elem = null;</code></pre>
<p>IMO czytelniej. Gdyby ktoś pytał czemu przecinek jest przerzucony na początek nowej linii, a nie zostawiony na końcu poprzedniej: spróbuj pousuwać parę zmiennych z listy. Jeśli przecinek jest na końcu linijki, musisz usunąć interesującą Cię zmienną, a następnie przecinek. Tak usuwasz jedno i drugie za jednym zamachem i na pewno nie zostawisz przecinka przez nieuwagę.</p>

<p class="alert alert-info">Od kiedy ten tutorial powstał, jednak powróciłem do "normalnego" sposobu zapisu przecinków. Mój styl można podejrzeć <a href="https://github.com/Comandeer" rel="noopener noreferrer" class="alert-link">na moim GitHubie</a>, a zwłaszcza <a href="https://github.com/BEMQuery/bemquery-package-boilerplate" rel="noopener noreferrer" class="alert-link">w projekcie BEMQuery</a>.</p>

<div class="heading"><h3 id="strict">Strict mode</h3><a href="#strict" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>To małe cudeńko bardzo ułatwia życie, utrudniając je. Włączenie tzw. "strict mode" (tryb ścisły jak ktoś polski lubi) usuwa najbardziej bugowate części JS (np. <code>with</code> czy też ciut naprawia stringi w <code>setTimeout</code>). Co więcej, nie pozwala nam tworzyć nieświadomie zmiennych globalnych, np tak:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">for(i = 0; i&lt;tab.length; i++)</code></pre>
<p>W trybie ścisłym każda zmienna musi być zadeklarowana przed użyciem</p>
<p class="code">Kod:</p><pre><code class="language-javascript">for(var i = 0; i &lt; tab.length; i++)</code></pre>
<p>A jak włączyć naszego małego przyjaciela? Prosto</p>
<p class="code">Kod:</p><pre><code class="language-javascript">"use strict"; //na samym początku skryptu żeby działał wszędzie
function a()
{
	"use strict"; //lub w funkcji, aby działał tylko w niej
}</code></pre>
<p>Od razu uprzedzam, że jeśli nigdy nie zwracałeś uwagi na jakość swojego JS, to po włączeniu strict mode skrypty Ci się wykrzaczą. Ale przystosowanie ich do strict mode wcale nie jest trudne, a w przyszłości na pewno przyniesie korzyści (bo np. ociupinkę zmieni się składnia JS).</p>

<div class="heading"><h3 id="literaly">Literały</h3><a href="#literaly" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>Spójrzmy na ten kod:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var a = new Array(1, 2, 3)
,b = new Object();

b.a = 1;
b.b = 2;

for(var i = 0; i&lt;a.length; i++)
	console.log(a[i]);

for(var x in b)
	console.log(b&#91;x&#93;);</code></pre>
<p>Wydaje się zupełnie poprawny, prawda? Owszem, może i jest poprawny, ale nie bezpieczny!</p>
<p class="code">Kod:</p><pre><code class="language-javascript">Array = function() {return '';};
Object = Array;

var a = new Array(1,2,3)
,b = new Object();

b.a = 1;
b.b = 2;

for(var i = 0; i&lt;a.length; i++)
	console.log(a&#91;i&#93;);

for(var x in b)
	console.log(b&#91;x&#93;);</code></pre>
<p>I mamy krzak, nawet w strict mode! Bezpieczniej użyć literałów:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">Array = function() {return '';};
Object = Array;

var a = &#91;1,2,3&#93;
,b = {a:1, b:2};

for(var i = 0; i &lt; a.length; i++)
	console.log(a&#91;i&#93;);

for(var x in b)
	console.log(b&#91;x&#93;);</code></pre>
<p>Tych wykrzaczyć się nie da ;)</p>

<div class="heading"><h3 id="setTimeout">setTimeout</h3><a href="#setTimeout" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>Nie przekazuj nazwy funkcji jako stringa!</p>
<p class="code">Kod:</p><pre><code class="language-javascript">setTimeout("funkcja()", 1000); //don't do this!</code></pre>
<p>Tym samym wywołujesz sobie <code>eval</code>, a jak każdy wie – <code>eval</code> jest <s>złe</s> niepotrzebnie wykorzystywane, co jedynie obniża wydajność! Przekaż uchwyt do funkcji:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">setTimeout(funkcja, 1000);</code></pre>
<p>A jak już musisz parametry przekazać:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">setTimeout(function(){funkcja(1, 2);}, 1000);
//lub
setTimeout(funkcja, 1000, 1, 2);</code></pre>

<div class="heading"><h3 id="petle">Pętle i obiekty</h3><a href="#petle" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>Masz obiekt i musisz po nim poiterować? Zapewne robisz coś takiego:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var o = {
	a: 1
	,b: 2
	,c: 3
};

for(var x in o)
{
	console.log(o&#91;x&#93;);
}</code></pre>
<p>Zgadłem? No to źle robisz:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">Object.prototype.oops = 'BUGAHA!';

var o = {
	a: 1
	,b: 2
	,c: 3
};

for(var x in o)
{
	console.log(o&#91;x&#93;);
}</code></pre>
<p>Powyższy kod wyświetli nam także 'BUGAHA!' (bo <code>for..in</code> iteruje także po wszystkich nienatywnych rozszerzeniach prototypu <code>Object</code>). Nie tego chcemy, prawda? A wystarczy dodać jedną linijkę:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">Object.prototype.oops = 'BUGAHA!';

var o = {
	a: 1
	,b: 2
	,c: 3
};

for(var x in o)
{
	if(o.hasOwnProperty(x))
		console.log(o&#91;x&#93;);
}</code></pre>
<p>I już. Metoda <code>hasOwnProperty</code> sprawdza czy wartość podana jako x na pewno jest częścią naszego obiektu i czy nie pochodzi z prototypu.</p>
<p>Jest też inny sposób, aby zupełnie ominąć jakiekolwiek prototypy i nie martwić się o nie:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">Object.prototype.oops = 'BUGAHA!';

var o = Object.create(null);
o.a = 1;
o.b = 2;
o.c = 3;

for(var x in o)
{
	console.log(o&#91;x&#93;);
}</code></pre>
<p><code>Object.create</code> tworzy nam obiekt z prototypu podanego jako pierwszy parametr, tak więc tworzymy obiekt z pustym prototypem (domyślnie jest to <code>Object.prototype</code>). W starszych przeglądarkach ten sposób nie działa.</p>
<p>Jeszcze ładniej można to zrobić, korzystając z <code>Object.keys</code> (która to metoda nie szuka niczego w prototypach i zwraca wszystko w postaci normalnej tablicy kluczy):</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var o = {
	a: 1
	,b: 2
	,c: 3
};

Object.keys(o).forEach(function(x)
{
	console.log(o&#91;x&#93;);
});</code></pre>

<div class="heading"><h3 id="namespaces">Funkcje natychmiastowego wywołania i przestrzenie nazw</h3><a href="#namespaces" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>Każdy doskonale wie, że zmienne globalne są bleeee. Jednak w wielu skryptach można znaleźć coś takiego:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var width = 0;
var height = 0;
var img = null;
var elem = null;
//itp.</code></pre>
<p>Tym sposobem brudzimy sobie globalny scope!</p>
<p class="code">Kod:</p><pre><code class="language-javascript">console.log(window&#91;'width'&#93;);</code></pre>
<p>A można lepiej, wykorzystując zasięg zmiennych:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">(function()
{
	var width = 0;
	var height = 0;
	var img = null;
	var elem = null;
}());
console.log(window&#91;'width'&#93;);</code></pre>
<p>OK, a jeśli chcemy coś specjalnie umieścić w globalnym scope, np. funkcje naszego super-hiper API? Oczywiście głupim pomysłem jest ładowanie oddzielnie wszystkich 150+ funkcji, bo istnieje szansa, że coś naszego nadpisze funkcje już używane na stronie (np. funkcja o nazwie <code>resizeImg</code>). Wtedy możemy posłużyć się przestrzenią nazw:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">
var API = {
	resizeImg: function()
	{
		console.log('wywołano');
	}
};
API.resizeImg();
</code></pre>
<p>Po połączeniu obydwu metod możemy osiągnąć coś takiego</p>
<p class="code">Kod:</p><pre><code class="language-javascript">(function($)
{
	var API = {}
	,resizeImg = jakiswarunek ? function() {console.log('a');} : function() {console.log(b);};

	API.resizeImg = resizeImg;
	$.API = API;
}(window))</code></pre>
<p>Voila! W globalnym scope mamy tylko to, co chcieliśmy mieć!</p>

<div class="heading"><h3 id="feature-detection">Feature detection</h3><a href="#feature-detection" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<blockquote><p>Sniffing an user agent is like sniffing a glue</p><footer><cite>"porneL"</cite></footer></blockquote>
<p>Dlatego też, zamiast opierać się na wątpliwym przekonaniu, że w IE 5.5.1733958399 zainstalowanym pod Win XP z SP 14 na pewno to działa, warto sprawdzić czy naprawdę funkcja x istnieje i jest funkcją. Wyobraźmy sobie choćby, że chcemy stworzyć obiekt przy pomocy <code>Object.create</code>, ale nie jesteśmy pewni czy ta metoda istnieje:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">var o = Object.create(null);</code></pre>
<p>W starszych IE wywali nam ładny ReferrenceError. A wystarczy sprawdzić czy ta metoda istnieje:</p>
<p class="code">Kod:</p><pre><code class="language-javascript">if(typeof Object.create === 'function')</code></pre>
<p>Jeśli nie, to można walnąć <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/create#Polyfill" rel="noopener noreferrer">polyfilla</a>. Na tej samej zasadzie działa cała biblioteka <a href="http://modernizr.com" rel="noopener noreferrer">Modernizr</a>.</p>

<div class="heading"><h3 id="delegation">Event delegation</h3><a href="#delegation" title="Bezpo&#x15B;redni link do sekcji"><span class="glyphicon glyphicon-link" aria-hidden="true"></span><span class="sr-only">Bezpośredni link do sekcji</span></a></div>
<p>Zdarzenia bąbelkują (jak ktoś nie wierzy, to niech <a href="http://www.quirksmode.org/js/events_order.html" rel="noopener noreferrer">poczyta</a>). Dlatego też możliwe staje się odkrycie, że jakiś tam akapit w jakimś tam divie został kliknięty.</p>
<p class="code">Kod:</p><pre><code class="language-javascript">(function(d)
{
	d.getElementsByTagName('div')&#91;0&#93;.addEventListener('click', function(e)
	{
		var t = e.target;
		if(t.tagName.toLowerCase() === 'p')
			console.log(t.innerHTML);
	}, false);
}(document));</code></pre>
<p>Kiedy warto tego użyć? Jeśli np. mamy dużo przycisków na stronie i wszystkie są w jednym rodzicu. Zamiast przypisywać zdarzenia do każdego z nich, można przypisać te zdarzenia do ich rodzica i za pomocą <code>e.target</code> (w IE <code>e.srcElement</code>) sprawdzić, co tak naprawdę zostało kliknięte. Przydaje się także przy stronach ajaksowych, gdzie część elementów interaktywnych zostanie dodana po wczytaniu strony. Wtedy można doczepić zdarzenie np. do <code>body</code> i mieć pewność, że każdy przycisk będzie klikalny.</p>

						</article>
						<section id="komentarze">
							<h2>Komentarze</h2>
							<div id="disqus_thread"></div>
							<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
							<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
						</section>
					</main>
				</div>
			</div>

			<footer class="site-footer">
				<div class="container-fluid">
					<p>Copyright © by <a href="https://www.comandeer.pl" rel="author">Comandeer</a>.</p>
				</div>
			</footer>

			<script>
			( function() {
				try {
					var codes = document.getElementsByClassName( 'code' );

					[].forEach.call( codes, function( code ) {
						var next = code.nextElementSibling;

						if ( !next || next.tagName.toLowerCase() !== 'pre' || next.scrollHeight < 300 ) {
							return false;
						}

						code.innerHTML = code.innerHTML.replace( ':', ' <span class="code-switch">[Rozwiń]</span>:' );
						code.getElementsByTagName( 'span' )[ 0 ].toSwitch = next;
					} );

					document.addEventListener( 'click', function( evt ) {
						if ( !evt.target || !evt.target.classList.contains( 'code-switch' ) ) {
							return true;
						}

						evt.preventDefault();

						var target = evt.target,
							next = target.toSwitch,
							html = target.innerHTML;

						if ( !next || next.tagName.toLowerCase() !== 'pre' ) {
							return false;
						}

						next.classList.toggle( 'expanded' );
						target.innerHTML = ( html === '[Zwiń]' ? '[Rozwiń]' : '[Zwiń]' );
					} );

					//defer loading of disqus

					if ( location.host === 'tutorials.comandeer.pl' ) {
						window.disqus_shortname = 'comandeerowa';

						var dsq = document.createElement( 'script' );

						dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';

						( document.getElementsByTagName( 'head' )[ 0 ] || document.getElementsByTagName( 'body' )[ 0 ] ).appendChild( dsq );
					}
				} catch( err ) {}
			} () );
			</script>
			<script src="https://code.jquery.com/jquery-1.12.0.min.js" integrity="sha384-XxcvoeNF5V0ZfksTnV+bejnCsJjOOIzN6UVwF85WBsAnU3zeYh5bloN+L4WLgeNE" crossorigin="anonymous"></script>
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
			<script>
			$( 'nav' ).on( 'affix.bs.affix', function() {
				$( 'main' ).removeClass( 'col-md-offset-0' ).addClass( 'col-md-offset-4' );
			} ).on( 'affix-top.bs.affix affix-bottom.bs.affix', function() {
				$( 'main' ).removeClass( 'col-md-offset-4' );
			} ).affix( {
				offset: {
					top: function() {
						return ( this.top = $( '.navbar-fixed-top' ).outerHeight( true ) + 10 );
					},
					bottom: function () {
						return ( this.bottom = $( '.site-footer' ).outerHeight( true ) + 10 );
					}
				}
			} )
			</script>
			<script src="/js/prism.js"></script>
		</body>
	</html>
